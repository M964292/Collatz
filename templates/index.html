<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тренажёр гипотезы Коллатца</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f0f0f0;
            font-family: Arial, sans-serif;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .game-area {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .history-area {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .sequence {
            font-size: 1.2em;
            margin: 10px 0;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        .correct {
            color: green;
        }
        .incorrect {
            color: red;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center mb-4">Тренажёр гипотезы Коллатца</h1>
        
        <div class="game-area">
            <div class="row mb-3">
                <div class="col">
                    <button class="btn btn-primary" onclick="startRandomGame()">Случайное число</button>
                </div>
                <div class="col">
                    <div class="input-group">
                        <input type="number" id="customNumber" class="form-control" placeholder="Ваше число">
                        <button class="btn btn-secondary" onclick="startCustomGame()">Начать</button>
                    </div>
                </div>
            </div>

            <div class="instructions mb-3">
                <h5>Правила:</h5>
                <ol>
                    <li>Если число чётное, разделите его на 2</li>
                    <li>Если число нечётное, умножьте на 3 и прибавьте 1</li>
                    <li>Продолжайте, пока не получите 1</li>
                </ol>
            </div>

            <div id="gameContent" style="display: none;">
                <div class="current-number mb-3">
                    <h4>Текущее число: <span id="currentNumber"></span></h4>
                </div>

                <div class="answer-input mb-3">
                    <div class="input-group">
                        <input type="number" id="answer" class="form-control" placeholder="Ваш ответ">
                        <button class="btn btn-success" onclick="checkAnswer()">Проверить</button>
                    </div>
                </div>

                <div class="sequence" id="sequence"></div>
            </div>
        </div>

        <div class="history-area">
            <h3>История решений</h3>
            <div id="history"></div>
        </div>
    </div>

    <script>
        let currentNumber = null;
        let sequence = [];

        function startRandomGame() {
            fetch('/start_random')
                .then(response => response.json())
                .then(data => {
                    currentNumber = data.number;
                    sequence = data.sequence;
                    updateDisplay();
                });
        }

        function startCustomGame() {
            const number = document.getElementById('customNumber').value;
            if (!number) {
                alert('Введите число');
                return;
            }

            fetch('/start_custom', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ number: parseInt(number) })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(data.error);
                    return;
                }
                currentNumber = data.number;
                sequence = data.sequence;
                updateDisplay();
            });
        }

        function checkAnswer() {
            const answer = document.getElementById('answer').value;
            if (!answer) {
                alert('Введите ответ');
                return;
            }

            fetch('/check_answer', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ answer: parseInt(answer) })
            })
            .then(response => response.json())
            .then(data => {
                if (data.correct) {
                    if (data.game_over) {
                        alert(`Поздравляем! Вы решили задачу за ${data.time.toFixed(2)} секунд`);
                        updateHistory();
                    } else {
                        currentNumber = data.next_number;
                        sequence = data.sequence;
                        updateDisplay();
                    }
                } else {
                    alert(`Неверно! Правильный ответ: ${data.expected}`);
                }
                document.getElementById('answer').value = '';
            });
        }

        function updateDisplay() {
            document.getElementById('gameContent').style.display = 'block';
            document.getElementById('currentNumber').textContent = currentNumber;
            document.getElementById('sequence').textContent = sequence.join(' → ');
        }

        function updateHistory() {
            fetch('/history')
                .then(response => response.json())
                .then(data => {
                    const historyHtml = data.map(game => `
                        <div class="mb-2">
                            <strong>Начальное число:</strong> ${game.start}<br>
                            <strong>Шагов:</strong> ${game.steps}<br>
                            <strong>Время:</strong> ${game.time.toFixed(2)} сек<br>
                            <strong>Последовательность:</strong> ${game.sequence.join(' → ')}<br>
                            <hr>
                        </div>
                    `).join('');
                    document.getElementById('history').innerHTML = historyHtml;
                });
        }

        // Загружаем историю при загрузке страницы
        updateHistory();
    </script>
</body>
</html>